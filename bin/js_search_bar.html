<script>
/*
 *  This is a file that gets stored locally on all of my machines.
 *
 *  Because it's stored locally, it can be loaded very quickly.
 *
 *  Whenever you do a search in a browser, the search gets redirected here, and
 *  the Javascript code makes some decisions about where to send your search
 *  to.
 *
 *  Load this file by itself to see the full help text.
 *
 */


/* TODO:
 *      - add instructions for setting this up on Chrome
 */

var commands = {
    google   : "https://www.google.com/search?q=%s&ie=utf-8&oe=utf-8",
    perl     : "http://perldoc.perl.org/search.html?q=%s",
    perlfunc : "http://perldoc.perl.org/functions/%s.html",
    cpan     : "https://metacpan.org/search?q=%s",
    man      : "http://man.cx/%s",
    js       : "https://www.google.com/search?q=site%3Adeveloper.mozilla.org+%s&ie=utf-8&oe=utf-8",
    testing  : function() {     // an example of how (typeof(cmd) == "function") works
        return "http://reddit.com";
    },
};


function main() {
    if (window.location.search.match(/^\??$/)) {
        // if the page is loaded directly, display the help text in <script language="ignore"> below
        show_help_text();
    } else {
        parse_search();
    }
}


function show_help_text() {
    document.write( document.getElementById("really_html").innerHTML );
}


function parse_search() {
    var search = decodeURIComponent(
                    window.location.search
                        .replace(/^\?/, "")
                        .replace(/\+/g, "%20"));
    var cmd = search.match(/^(\S+)/)[0];
    search = search.replace(/^\S+\s+/, "");
    do_search(cmd, search);
}


function do_search(cmd, args) {
    //alert(cmd + "\n" + args);
    if (!commands[cmd]) {
        //alert("unknown command: " + cmd);
        //show_help_text();
        //return;

        // fallback to just googling the whole thing
        args = cmd + " " + args;
        cmd = "google";
    }
    var redirectto = commands[cmd];
    if (typeof(redirectto) == "string") {
        redirectto = redirectto.replace(/%s/, encodeURI(args));
    } else if (typeof(redirectto) == "function") {
        redirectto = redirectto(args);
    } else {
        alert("oops");
        return;
    }
    window.location = redirectto;
}


</script>




<!-- if we're doing a search, we don't want to spend any time trying to parse or render HTML -->
<script id="really_html" language="ignore">

<style>
    /* --==##  links aren't underlined unless you :hover  ##==-- */
    a:hover {text-decoration:underline}
    a {text-decoration:none}
    @media print { a {text-decoration:underline} }

    /* --==##  make h1/h2/h3 stand out with bars  ##==-- */
    h1, h2, h3 {padding:0.3em; border-top:2px solid #000; border-bottom:2px solid #000;
    background-color:#ccc; margin-top:2em}
    body>h1:first-child, body>h2:first-child, body>h3:first-child {margin-top:0}

    /* --==##  table cells have a nice border  ##==-- */
    table.wikitable {border-collapse:collapse}
    table.wikitable td, table.wikitable th {border:1px solid #aaa; padding:0.3em}
    table.wikitable th {background-color:#000; color:#fff}
    table.wikitable th a {color:#aaf}
    table.wikitable th a:visited {color:#faf}
    table.wikitable tr.header td, table.wikitable thead td {border:#fff}

    /* --==##  kbd has gray background  ##==-- */
    kbd {background-color:#bbb}

    /* --==##  selectively make ul/ol spaced (non-cascading)  ##==-- */
    ul.spaced > li, ol.spaced > li {margin-bottom:1em}
    .spaced > li > .spaced {margin-top:1em}

    /* --==##  CSS reset  ##==-- */
    a img {border:0}
</style>


This allows you to replace the default search engine in Firefox + Chrome with one that has some custom Javascript features:

<ul>
<li>preconfigured <a href="https://developer.mozilla.org/en/Bookmark_Keywords">keymarks</a>
<li>some keymarks have some extra Javascript code
</ul>


<h3>Setup instructions</h3>
<ul class=spaced>
<li><b>Firefox</b>
    <ul>
    <li><tt>about:config</tt> &gt; point <A href="http://kb.mozillazine.org/Keyword.URL">keyword.url</a> to this URL
    </ul>
<li><b>Firefox</b>
    <ul>
    <li>install the <a href="https://addons.mozilla.org/en-US/firefox/addon/add-to-search-bar/">Add To Search Bar</a> extension
    <li>right-click in the search box above, and choose "Add to search bar"
    </ul>
<li><b>Chrome</b>
    <ul>
    <li>...
    </ul>
</ul>

</script>







<script>
main();
</script>
